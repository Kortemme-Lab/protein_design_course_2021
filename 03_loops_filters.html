
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Loop Modeling &amp; Filters Exercise &#8212; Computational Protein Design Minicourse</title>
    
  <link rel="stylesheet" href="_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.e7340bb3dbd8dde6db86f25597f54a1b.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Homepage" href="_intro.html" />
    <link rel="prev" title="Ligand Binding Site Design Exercise" href="02_LigandDesign.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  <img src="_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Computational Protein Design Minicourse</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="00_getting_started_with_rosetta.html">
   Getting started with PyRosetta and PyMOL
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="01_RosettaDesign.html">
   Rosetta Design
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_LigandDesign.html">
   Ligand Binding Site Design Exercise
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Loop Modeling &amp; Filters Exercise
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="_intro.html">
   Homepage
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="accessing_the_course.html">
   Accessing the course
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ddg_exercise.html">
   ΔΔG Exercise
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="groups.html">
   Project Info
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="installation_instructions.html">
   Installing Course Prerequisites
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="papers.html">
   Relevant Publications
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="schedule.html">
   Course Schedule
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="trRosetta_exercise.html">
   Structure Prediction
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/03_loops_filters.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i>
            Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#loop-modeling">
   Loop modeling
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#filtering">
   Filtering
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pareto-fronts-if-time">
   Pareto fronts (if time)
  </a>
 </li>
</ul>

        </nav>
        
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="loop-modeling-filters-exercise">
<h1>Loop Modeling &amp; Filters Exercise<a class="headerlink" href="#loop-modeling-filters-exercise" title="Permalink to this headline">¶</a></h1>
<div class="section" id="loop-modeling">
<h2>Loop modeling<a class="headerlink" href="#loop-modeling" title="Permalink to this headline">¶</a></h2>
<p>In this exercise, we will take a look at some results from a few different loop modeling simulations of the adenine-recognition loop in guanylate kinase (residues 167-186).</p>
<p>Download the prepared RosEasy workspace and unzip its contents:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl -O &lt;url coming soon&gt;
tar -xzvf loop_modeling.tar.gz
<span class="nb">cd</span> loop_modeling
</pre></div>
</div>
<p>In this workspace are 5 folders with the outputs of various simulations.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">01_designs/</span></code> contains outputs for a FastRelax simulation, which was used to prepare the input files for the rest of the simulations. You can ignore this folder.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">02_validated_designs/</span></code> contains outputs from a next-generation KIC simulation (NGK). This LoopModeler protocol samples torsions from a Ramachandran distribution and closes chain breaks with KIC.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">03_validated_designs/</span></code> contains outputs from a loophash-KIC simulation (LHKIC). Here, torsions are sampled from fragments which roughly bridge a random subsegment of the loop.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">04_validated_designs/</span></code> contains outputs from a fragment-KIC simulation (FKIC). Torsions here are sampled from fragments which were picked, prior to running the simulation, based on their similarity to the target sequence.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">05_validated_designs/</span></code> contains outputs from a fragment-CCD simulation (CCD). Here, torsions were also sampled from fragments picked based on sequence similarity to the target sequence, but the chain breaks were closed using closed cyclic descent.</p></li>
</ul>
<p>Plot the outputs of the loop modeling simulations:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>roseasy plot */outputs/*
</pre></div>
</div>
<p>(This command will not plot the FastRelax outputs due to the way RosEasy’s output subdirectories are organized.)<br />
On the X-axis, select “loop_rmsd”. This view plots each model’s total Rosetta score versus the model’s RMSD to the crystal structure. In structure prediction runs,
it is desirable to see a “funneling” of points towards the low-REU, low-RMSD region of the graph; this means that, as far as Rosetta can tell within the limits of its sampling and scoring, there is an energetic
drive towards the correct structure, with few or no viable alternative conformations.</p>
<p>Using the pane on the left, scroll through the different protocols. <strong>Which method best predicted the loop structure?</strong></p>
<p>You can right-click each of the points and select <code class="docutils literal notranslate"><span class="pre">compare_to_input</span></code> to view the model in PyMOL aligned with the input structure, with the remodeled portion of the loop colored in orange.<br />
This “loop” is part beta sheet, part alpha helix, and part coil. <strong>Look through the different methods and use the <code class="docutils literal notranslate"><span class="pre">compare_to_input</span></code> feature to examine a few models from each protocol
that scored well but had &gt;1A loop RMSDs.
What type of secondary structure did each of the methods tend to get wrong?</strong></p>
<p>Now change the X-axis to display <code class="docutils literal notranslate"><span class="pre">avg_9_residue_fragment_crmsd</span></code>. This is the Fragment quality metric that we discussed in class.</p>
<p><strong>Which method(s) produce the best fragment quality? Why?</strong></p>
<p>Change the Y-axis to display <code class="docutils literal notranslate"><span class="pre">loop_rmsd</span></code>, so that you are plotting fragment quality vs. RMSD.</p>
<p><strong>Is there a correlation between fragment quality and loop RMSD? Does this correlation depend on which method you look at? Which methods have this correlation and why?</strong></p>
</div>
<div class="section" id="filtering">
<h2>Filtering<a class="headerlink" href="#filtering" title="Permalink to this headline">¶</a></h2>
<p>The Rosetta scorefunction has limitations, both in its ability to accurately predict stability and in its applicability to specific problems. A good example is that, because all Rosetta score terms must be pairwise decomposable (summable 2-body energies) to keep simulation times fast, Rosetta can not know via a Rosetta score whether there are any buried unsatisfied hydrogen bonds, which can substantially destabilize a structure. Filters and SimpleMetrics help us to account for these limitations. Contrary to their name, filters are often used as metrics at the end of a simulation, rather than as filters that throw out designs.</p>
<p>In this exercise, we will examine part of the dataset from the de novo protein stability paper by Gabe Rocklin et. al. The dataset we will examine consists of four rounds of design, each containing around 3,000 proteins. Designs were created using FastDesign, with each round having increasingly stringent filters and resfiles. The detailed design protocol can be found in the supplemental material: <a class="reference external" href="https://science.sciencemag.org/content/sci/suppl/2017/07/12/357.6347.168.DC1/aan0693_Rocklin_SM.pdf">https://science.sciencemag.org/content/sci/suppl/2017/07/12/357.6347.168.DC1/aan0693_Rocklin_SM.pdf</a></p>
<p>First, download the dataset from <a class="reference external" href="https://ucsf.box.com/s/269cgkn7wg4gmw3og93vj4ffd90f7so4">https://ucsf.box.com/s/269cgkn7wg4gmw3og93vj4ffd90f7so4</a> to your class folder.
Unzip the file and <code class="docutils literal notranslate"><span class="pre">cd</span></code> into the folder.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tar -xzvf filter_exercise.tar.gz 
<span class="nb">cd</span> filter_exercise
</pre></div>
</div>
<p>This workspace contains 4 folders, one from each round of design from the Rocklin paper. Plot all four rounds:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>roseasy plot */outputs/
</pre></div>
</div>
<p>Note that at any time, you can right-click on a point and select ‘open in pymol’ to view the structure in more detail. This may be helpful in explaining what filters are picking up on.</p>
<p>Set the y-axis to display the <code class="docutils literal notranslate"><span class="pre">stability</span> <span class="pre">score</span></code>. <strong>This score represents the experimental results for that design sequence; higher is better.</strong>
Examine the relationship between stability and a variety of metrics by cycling through different x-axis metrics, making sure to look at the following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Total</span> <span class="pre">score</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">buried_np</span></code> (buried nonpolar surface area)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unsat_hbond</span></code> (# of buried unsatisfied hydrogen bonds)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">exposed_hydrophobics</span></code> (surface area of exposed hydrophobic residues)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pack</span></code>/<code class="docutils literal notranslate"><span class="pre">cavity_volume</span></code>/<code class="docutils literal notranslate"><span class="pre">holes</span></code> (different ways of measuring the volume of internal cavities in the protein)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">average_fragment</span></code> (averaged backbone RMSDs of protein fragments with similar sequence to design)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">worst_fragment</span></code> (worst backbone RMSD of fragments with similar sequence to design)</p></li>
</ul>
<p><strong>Which metrics seem to correlate with the stability score in earlier rounds? Is there a difference between which metrics are effective in each round?</strong></p>
<p><strong>Does the number of buried unsatisfied hydrogen bonds correlate with stability score in this dataset? Given what we know about the energetic
cost of buried unsatisfied hydrogen bonds, why might that be?</strong></p>
<p><strong>Select a metric that either seems to correlate with stability or has at least 2 distinct clusters, and examine a few structures from either extreme/both clusters in PyMOL. Can you spot any trends in what the metric is picking up on? (For some metrics it may help to enter <code class="docutils literal notranslate"><span class="pre">show</span> <span class="pre">sticks,</span> <span class="pre">all</span></code> in PyMOL.)</strong></p>
</div>
<div class="section" id="pareto-fronts-if-time">
<h2>Pareto fronts (if time)<a class="headerlink" href="#pareto-fronts-if-time" title="Permalink to this headline">¶</a></h2>
<p>Now that we have some idea of how well each metric correlates with stability, it’s time to try and find some combination of metrics that gives us the greatest chance of selecting stable designs. Pareto fronts are one such way of doing this. A design is “pareto efficient”, or part of a Pareto front, if there are no other designs which have better scores in all of the metrics being evaluated. You can have as many metrics be a part of a Pareto front as you wish, but as you do so, you increase the number of designs which will be considered Pareto efficient.</p>
<p><img alt="Pareto fronts" src="_images/pareto.png" /></p>
<p>We will use Pareto fronts to see if we can use the metrics that seem to correlate with stability score to further increase our chances of picking stable designs.</p>
<p>Pick 3-4 metrics that you think are predictive of stable designs. You are going to create a “picks” file, which tells RosEasy how to pick designs for computational validation. Picks files have the following format and should have a <code class="docutils literal notranslate"><span class="pre">.yml</span></code> extension:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">threshold</span><span class="p">:</span>
<span class="o">-</span> <span class="n">restraint_dist_e38</span> <span class="o">&lt;</span> <span class="mf">0.8</span>
<span class="o">-</span> <span class="n">h_bond_to_e38_sidechain</span> <span class="o">==</span> <span class="mi">0</span>
<span class="o">-</span> <span class="n">oversaturated_h_bonds</span> <span class="o">==</span> <span class="mi">0</span>

<span class="n">pareto</span><span class="p">:</span>
<span class="o">-</span> <span class="n">total_score</span>
<span class="o">-</span> <span class="n">restraint_dist_e38</span>
<span class="o">-</span> <span class="n">max_9_residue_fragment_rmsd_c</span>

<span class="n">depth</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">epsilon</span><span class="p">:</span> <span class="mf">0.5</span>
</pre></div>
</div>
<p>Metrics under “threshold” tell RosEasy to throw out any designs that do not meet the threshold. We will not include any thresholds for now. Metrics under <code class="docutils literal notranslate"><span class="pre">pareto</span></code> are included in a pareto optimization. These metric names are the same as the name on the <em>left</em> in the plotting GUI (circled in the image below). You should set <code class="docutils literal notranslate"><span class="pre">epsilon</span></code> to 0; this value is a way of tuning how many designs make it through the Pareto optimization (higher numbers means fewer designs). You may want to play around with the <code class="docutils literal notranslate"><span class="pre">depth</span></code> setting; this integer value tells RosEasy how many times to run the Pareto optimization. So if <code class="docutils literal notranslate"><span class="pre">depth</span></code> is set to 2, RosEasy will run a Pareto optimization, remove those designs from consideration, and then run a second Pareto optimization.</p>
<p><img alt="Metric names" src="_images/metric_names.png" /></p>
<p>Note that in order for a metric to be included in a Pareto front, RosEasy must know whether higher scores or lower scores are better. Normally it detects this via naming conventions, but because these designs were created using another workflow, we have to specify these directions ourselves. For each of your metrics, determine whether higher scores (<code class="docutils literal notranslate"><span class="pre">+</span></code>) or lower scores (<code class="docutils literal notranslate"><span class="pre">-</span></code>) are “better”. Then, open <code class="docutils literal notranslate"><span class="pre">04_designs/outputs/metrics.yml</span></code>, locate your metric name, and edit</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="02_LigandDesign.html" title="previous page">Ligand Binding Site Design Exercise</a>
    <a class='right-next' id="next-link" href="_intro.html" title="next page">Homepage</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Kortemme Lab<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>